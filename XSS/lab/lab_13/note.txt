XSS - Reflected XSS with event handlers and href attributes blocked

End Goal: To solve the lab, perform a cross-site scripting attack that injects a vector that, when clicked, calls the alert function. Note that you need to label your vector with the word "Click" in order to induce the simulated lab user to click your vector. For example: <a href="">Click me</a>

Analystic
---------
Bước 1: Có thể thấy có 1 số thẻ bị chặn trong trường tìm kiếm này, ví dụ thử nhập <h1> --> ta sẽ nhận được phản hồi "Tag is not allowed", điều này được thực hiện bởi tường lửa của ứng dụng web, tuy nhiên có 1 số thẻ có thể vượt qua tường lửa. Ví dụ: <a>Click me</a>, trang web trả về: 0 search results for 'Click me', chúng ta có thể nhấp vào được click me nhưng ko có hiện tượng gì xảy ra và nếu ta kiểm tra mã web, ta có thể thấy có 1 thẻ a được tạo ra. --> điều kiện lý tưởng nhất là tạo 1 thẻ a với href="javascript:alert(123)", tuy nhiên thuộc tính href đã bị chặn. Khi thử tìm kiếm ta có thể thấy ta không thể nhận được phản hồi của trang vì tường lửa đã chặn request. vì thẻ a không thể đi kèm với href --> ta sẽ tìm kiếm xem thẻ nào có thể hoạt động, đến xss cheat sheet, copy tất cả các tag và vào intrusder để tấn công --> ta có thể thấy có 1 số thẻ có thể hoạt động như: a, animate, image, svg, title. 
Trên thực tế animate thực sự là 1 phần tử svg nên thật hợp lý khi đoán rằng có thể các thẻ SVG cũng sẽ được cho phép, vì vậy hãy thử tìm kiếm với <svg> và kết quả cho thấy ta có thể sử dụng thẻ này.
Bước 2: nếu các phần tử svg có thể đưa được đưa ra vào trang nên đây thực sự chỉ là một trường hợp hiểu được 1 số tính năng của svg.Ý tưởng là chúng ta có thể Xác định đánh dấu cho 1 hình ảnh nhưng 1 trong những điều khác mà chúng ta có thể thực hiện bên trong SVG là chúng ta có thể sử dụng các phần tử, chẳng hạn như chúng ta có thể có 1 phần tử như <svg><a>Click Me</a></svg>, nhận thấy rằng chúng ta thực sự không nhận được hiển thị trên trang và lí do là nếu chúng ta muốn đưa văn bản vào trong svg, chúng ta phải sử dụng một thành phần văn bản nên thực tế cách đánh dấu chính xác là: <svg><a><text>Click me</text></a></svg> chúng ta có thể chỉ định một số tính năng của thẻ văn bản đó, vì vậy hãy chú ý những tài liệu web mdn nói phần tử văn bản svg vẽ 1 phần tử đồ họa bao gồm văn bản, nó còn nói nếu văn bản đưa vào svg không nằm trong thành phần văn bản thì nó không được hiển thị nên chúng tôi biết với HTML, chúng ta có thể chỉ đưa text vào bất cứ đâu và nếu nó không nằm trong thẻ thì nó sẽ chỉ hiển thị dưới dạng văn bản thuần túy đến trang; Đây không phải là cách mọi thứ hoạt động với SVG, chúng ta thực sự phải đặt text của mình vào trong hộp thông báo, chúng ta có thể chỉ định kích thước, chúng ta có thể có thuộc tính x và y nên giờ hãy quay lại lab. Ta biết rằng chúng ta muốn chỉ định một thuộc tính x, hãy đặt nó thành 20 và y là 20. Giờ ta sẽ tìm kiếm như sau: <svg><a><text x=20 y=20>Click me</text></a></svg>, chúng ta sẽ thực sự thấy Click me của mình được hiển thị trên trang. Thực tế đó là thẻ liên kết nếu chúng ta kiểm tra điều này trong DOM, chúng ta sẽ thấy rằng chúng ta có thẻ liên kết và chúng ta có text bên trong thẻ liên kết đó nên nó hoạt động như một thẻ liên kết, nó chỉ không có thuộc tính href và cho đến nay chúng ta biết bao gồm các thuộc tính href đang bị chặn bởi tường lửa của ứng dụng web nhưng đây là lúc thẻ SVG animate xuất hiện đang hoạt động. Giờ hãy xem lại thẻ animate này trên mdn webdocs, nó nói rằng phần tử SVG animate cung cấp 1 cách để tạo hoạt ảnh và phần tử thực sự theo thời gian, điều này thú vị vì vấn đề của chúng ta là chúng ta không thể thêm thuộc tính href vào 1 thẻ a nhưng cho chúng ta biết rằng chúng ta có thể kiểm soát các thuộc tính này bằng cách sử dụng thẻ animate này. Quay lại tải trọng trước đó, chúng ta biết rằng bên trong thẻ a, chúng ta thực sự có thể xác định animate và chúng ta có thể đặt tên thuốc tính attributes = href , chúng ta muốn thêm values= và đây là lúc chúng ta có thể bao gồm javascript:alert(123) thì tất nhiên chúng ta muốn đóng thẻ animate của mình và chúng ta có thể sử dụng thẻ tự đóng cho điều đó --> payload lúc này là: <svg><a><animate attributeName=href values=javascript:alert(1)/><text x=20 y=20>Click Me</text></a> --> qua đây ta thấy ta có thể sử dụng thẻ animate bên trong thẻ SVG để kiểm soát thuộc tính trên phần tử gốc là thẻ a trong trường hợp này vì vậy chúng ta sẽ đặt tên thuộc tính là href và chúng ta cũng đặt giá trị của href là javascript:alert(1) bên trong thẻ a, chúng ta có 1 thẻ text, hãy nhớ rằng chúng ta đã thấy rằng trong SVG, bạn không thể chỉ bao gồm văn bản thuần túy mà bạn phải chỉ định văn bản trong thẻ text và chỉ định giá trị x và y cho kích thước của văn bản mà không cần thêm Ado.

--> Đây là 1 lab chủ yếu nhằm tìm hiểu các vecto tấn công có thể khác nhau nếu chúng ta có quyền truy cập vào các phần tử svg và thường thì các dev không phải lúc nào cũng sử dụng svg, bạn có thể có 1 trang web hoàn chỉnh nhà phát triển thực sự không sử dụng svg quá thường xuyên, đây là 1 lĩnh vực phát triển web mà ngay cả các dev web cũng không nhất thiết phải biết quá nhiều và ngay cả với tư cách là 1 nhà nghiên cứu bảo mật, bạn cũng có thể khá giỏi về các lĩnh vực xss nhưng bạn không thực sự hiểu cách svg hoạt động nên đây là 1 phòng thí nghiệm về các vecto tấn công có thể xảy ra nếu bạn có thể sử dụng thẻ svg và chúng ta đã thấy 1 số tính năng của svg, ví dụ như bạn cần sử dụng của phần text để bao gồm văn bản và cách bạn có thể kiểm soát các thuộc tính của phần tử gốc bằng cách đưa thẻ animate đó vào bên trong phần tử gốc trong vùng chứa svg.